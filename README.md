# ğŸ›¡ï¸ MLLM-Jailbreak-Defense

## åŸºäºæ„å›¾åˆ†æçš„å¤šæ¨¡æ€å¤§æ¨¡å‹è¶Šç‹±æ”»å‡»é˜²å¾¡æŠ€æœ¯ç ”ç©¶

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![Paper](https://img.shields.io/badge/Paper-In%20Progress-red.svg)]()
[![Contributions Welcome](https://img.shields.io/badge/Contributions-Welcome-brightgreen.svg)](CONTRIBUTING.md)

> ğŸ”¥ **æœ€æ–°æ›´æ–°**: æœ¬é¡¹ç›®æå‡ºäº†ä¸€ç§åŸºäºæ€ç»´é“¾(Chain of Thought)æ¨ç†ä¸æ„å›¾åˆ†æç›¸ç»“åˆçš„å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹è¶Šç‹±æ”»å‡»é˜²å¾¡æœºåˆ¶ï¼Œåœ¨å¤šç§æ”»å‡»åœºæ™¯ä¸‹å®ç°äº†æ˜¾è‘—çš„é˜²å¾¡æ•ˆæœæå‡ã€‚

---

## ğŸ“– ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#-é¡¹ç›®æ¦‚è¿°)
- [æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§)
- [æ–¹æ³•è®º](#-æ–¹æ³•è®º)
- [å®éªŒç»“æœ](#-å®éªŒç»“æœ)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [å®‰è£…æŒ‡å—](#-å®‰è£…æŒ‡å—)
- [ä½¿ç”¨æ–¹æ³•](#-ä½¿ç”¨æ–¹æ³•)
- [æ•°æ®é›†](#-æ•°æ®é›†)
- [è¯„ä¼°æŒ‡æ ‡](#-è¯„ä¼°æŒ‡æ ‡)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)
- [å¼•ç”¨](#-å¼•ç”¨)
- [è®¸å¯è¯](#-è®¸å¯è¯)
- [è”ç³»æˆ‘ä»¬](#-è”ç³»æˆ‘ä»¬)

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

éšç€å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹(MLLM)çš„å¹¿æ³›åº”ç”¨ï¼Œå…¶é¢ä¸´çš„å®‰å…¨å¨èƒä¹Ÿæ—¥ç›Šä¸¥é‡ã€‚ä¼ ç»Ÿçš„å•æ¨¡æ€é˜²å¾¡æ–¹æ³•åœ¨åº”å¯¹å¤šæ¨¡æ€è¶Šç‹±æ”»å‡»æ—¶æ•ˆæœæœ‰é™ã€‚æœ¬é¡¹ç›®æå‡ºäº†ä¸€ç§**åŸºäºæ„å›¾åˆ†æçš„å¤šæ¨¡æ€é˜²å¾¡æœºåˆ¶**ï¼Œç»“åˆ**æ€ç»´é“¾æ¨ç†(Chain of Thought, CoT)**æ–¹æ³•ï¼Œæ˜¾è‘—å¢å¼ºäº†MLLMåœ¨å¤æ‚è·¨æ¨¡æ€åœºæ™¯ä¸‹çš„å®‰å…¨æ€§ã€‚

### ğŸ¯ ç ”ç©¶ç›®æ ‡

- ğŸ” **å¤šæ¨¡æ€æ„å›¾åˆ†æ**: è®¾è®¡é«˜æ•ˆçš„æ„å›¾è¯†åˆ«æœºåˆ¶ï¼Œå‡†ç¡®æ£€æµ‹æ½œåœ¨å®‰å…¨é£é™©
- ğŸ§  **æ€ç»´é“¾æ¨ç†**: ä¼˜åŒ–åŸºäºCoTçš„æç¤ºè¯è®¾è®¡ï¼Œæå‡å¤æ‚åœºæ™¯ä¸‹çš„åˆ†æèƒ½åŠ›
- âš–ï¸ **å®‰å…¨æ€§ä¸æ•ˆç”¨æ€§å¹³è¡¡**: åœ¨ä¿è¯é˜²å¾¡æ•ˆæœçš„åŒæ—¶ç»´æŒæ¨¡å‹æ€§èƒ½
- ğŸ›¡ï¸ **é²æ£’æ€§éªŒè¯**: åœ¨å¤šç§æ”»å‡»ç­–ç•¥ä¸‹éªŒè¯é˜²å¾¡æ–¹æ³•çš„é€šç”¨æ€§

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ”§ æŠ€æœ¯äº®ç‚¹

- **ğŸ­ äº”é˜¶æ®µæ€ç»´é“¾é˜²å¾¡æ¡†æ¶**: åˆå§‹æŒ‡å¯¼è®¾ç½® â†’ æ„å›¾åˆ†æ â†’ å°è¯•å›åº” â†’ è‡ªæˆ‘åæ€ â†’ è‡ªæˆ‘å®Œå–„
- **ğŸ§­ é›¶æ ·æœ¬æ¨ç†æœºåˆ¶**: æ— éœ€é¢å¤–è®­ç»ƒï¼Œç›´æ¥åº”ç”¨äºç°æœ‰MLLM
- **ğŸ”„ è‡ªé€‚åº”åé¦ˆå¾ªç¯**: åŸºäºé˜²å¾¡å¤±è´¥æ¡ˆä¾‹çš„åŠ¨æ€ä¼˜åŒ–æœºåˆ¶
- **ğŸŒ è·¨æ¨¡æ€é€‚ç”¨æ€§**: æ”¯æŒæ–‡æœ¬ã€å›¾åƒã€è§†é¢‘ç­‰å¤šç§è¾“å…¥æ¨¡æ€

### ğŸ† æ€§èƒ½ä¼˜åŠ¿

- **ImgJPæ”»å‡»**: å®ç° **0% ASR** (æ”»å‡»æˆåŠŸç‡)ï¼Œå®Œå…¨é˜²å¾¡
- **FigStepæ”»å‡»**: ASRä»50.5%é™è‡³ **0%**
- **MM-SafetyBench**: ASRé™è‡³ **0.5%**ï¼Œä¼˜äºç°æœ‰æ–¹æ³•
- **é€šç”¨æ€§å¼º**: åœ¨InstructBLIPå’ŒLLaVa-v1.5ä¸¤ç§æ¨¡å‹ä¸Šå‡è¡¨ç°ä¼˜å¼‚

---

## ğŸ§  æ–¹æ³•è®º

### äº”é˜¶æ®µæ€ç»´é“¾é˜²å¾¡æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[é˜¶æ®µ1: åˆå§‹æŒ‡å¯¼è®¾ç½®]
    B --> C[é˜¶æ®µ2: æ„å›¾åˆ†æå’Œè®¸å¯è¯†åˆ«]
    C --> D[é˜¶æ®µ3: å°è¯•å›åº”]
    D --> E[é˜¶æ®µ4: è‡ªæˆ‘åæ€]
    E --> F{æ£€æµ‹åˆ°é£é™©?}
    F -->|æ˜¯| G[é˜¶æ®µ5: è‡ªæˆ‘å®Œå–„]
    F -->|å¦| H[è¾“å‡ºå®‰å…¨å›åº”]
    G --> H
```

#### ğŸ” å„é˜¶æ®µè¯¦ç»†è¯´æ˜

1. **é˜¶æ®µ1 - åˆå§‹æŒ‡å¯¼è®¾ç½®**: æ¿€æ´»æ¨¡å‹çš„æ¨ç†èƒ½åŠ›ï¼Œå»ºç«‹è´Ÿè´£ä»»å›åº”çš„åŸºç¡€
2. **é˜¶æ®µ2 - æ„å›¾åˆ†æ**: æ·±å…¥ç†è§£ç”¨æˆ·æŸ¥è¯¢çš„æœ¬è´¨æ„å›¾ï¼Œè¯„ä¼°å®‰å…¨æ€§ã€ä¼¦ç†æ€§å’Œåˆæ³•æ€§
3. **é˜¶æ®µ3 - å°è¯•å›åº”**: åŸºäºæ„å›¾åˆ†æç»“æœç”Ÿæˆåˆæ­¥å›åº”
4. **é˜¶æ®µ4 - è‡ªæˆ‘åæ€**: ç»“åˆç”¨æˆ·æŸ¥è¯¢å¯¹ç”Ÿæˆçš„å›åº”è¿›è¡Œå®‰å…¨æ€§è¯„ä¼°
5. **é˜¶æ®µ5 - è‡ªæˆ‘å®Œå–„**: å½“æ£€æµ‹åˆ°å®‰å…¨é£é™©æ—¶ï¼Œæ‹’ç»å›åº”å¹¶è¯´æ˜åŸå› 

---

## ğŸ“Š å®éªŒç»“æœ

### ä¸»è¦å®éªŒæ•°æ®

| æ”»å‡»æ–¹æ³• | æ¨¡å‹ | æ— é˜²å¾¡ | Self-Reminder | AdaShield-A | **æˆ‘ä»¬çš„æ–¹æ³•** |
|---------|------|--------|---------------|-------------|--------------|
| **FigStep** | InstructBLIP | 14.00% | 2.00% | **0%** | **0%** âœ¨ |
| | LLaVa-v1.5 | 50.50% | 8.50% | 9.00% | **0%** â­ |
| **ImgJP** | InstructBLIP | 43.00% | 22.50% | 12.50% | **0%** ğŸ¯ |
| | LLaVa-v1.5 | 85.50% | 58.00% | 34.50% | **0%** ğŸ”¥ |
| **MM-SafetyBench** | LLaVa-v1.5 | 32.00% | 15.50% | 2.00% | **0.5%** ğŸ’ |

> ğŸ“ˆ **å…³é”®æˆæœ**: æˆ‘ä»¬çš„æ–¹æ³•æ˜¯å”¯ä¸€åœ¨ImgJPæ”»å‡»ä¸Šå®ç°å®Œå…¨é˜²å¾¡çš„ç­–ç•¥ï¼Œå±•ç¤ºäº†åœ¨åº”å¯¹å¤æ‚å¯¹æŠ—æ€§æ”»å‡»æ—¶çš„ç‹¬ç‰¹ä¼˜åŠ¿ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ”§ ç¯å¢ƒè¦æ±‚

- Python 3.8+
- PyTorch 1.9+
- Transformers 4.20+
- CUDA 11.0+ (å¯é€‰ï¼Œç”¨äºGPUåŠ é€Ÿ)

### âš¡ ä¸€é”®è¿è¡Œ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/MLLM-Jailbreak-Defense.git
cd MLLM-Jailbreak-Defense

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œé˜²å¾¡æµ‹è¯•
python defense_test.py --model instructblip --attack figstep
```

---

## ğŸ› ï¸ å®‰è£…æŒ‡å—

### æ–¹å¼ä¸€: ä½¿ç”¨pipå®‰è£…

```bash
pip install -r requirements.txt
```

### æ–¹å¼äºŒ: ä½¿ç”¨condaç¯å¢ƒ

```bash
# åˆ›å»ºcondaç¯å¢ƒ
conda create -n mllm-defense python=3.8
conda activate mllm-defense

# å®‰è£…ä¾èµ–
pip install torch torchvision transformers
pip install -r requirements.txt
```

### ä¾èµ–åŒ…åˆ—è¡¨

```txt
torch>=1.9.0
torchvision>=0.10.0
transformers>=4.20.0
Pillow>=8.3.0
numpy>=1.21.0
pandas>=1.3.0
matplotlib>=3.4.0
seaborn>=0.11.0
tqdm>=4.62.0
```

---

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ä½¿ç”¨

```python
from mllm_defense import MLLMDefender

# åˆå§‹åŒ–é˜²å¾¡å™¨
defender = MLLMDefender(
    model_name="instructblip",
    defense_strategy="cot_intention"
)

# å¯¹è¾“å…¥è¿›è¡Œé˜²å¾¡æ£€æµ‹
result = defender.defend(
    text_input="Your text query here",
    image_input="path/to/image.jpg"  # å¯é€‰
)

print(f"å®‰å…¨çŠ¶æ€: {result['is_safe']}")
print(f"å›åº”: {result['response']}")
```

### é«˜çº§é…ç½®

```python
# è‡ªå®šä¹‰é˜²å¾¡å‚æ•°
defender = MLLMDefender(
    model_name="llava-v1.5",
    defense_strategy="cot_intention",
    config={
        "temperature": 0.7,
        "max_tokens": 512,
        "safety_threshold": 0.8,
        "enable_self_reflection": True
    }
)
```

### æ‰¹é‡æµ‹è¯•

```bash
# åœ¨æµ‹è¯•æ•°æ®é›†ä¸Šè¿è¡Œè¯„ä¼°
python evaluate.py \
    --dataset harmbench \
    --model instructblip \
    --attack_methods figstep,imgtp,mm_safety \
    --output_dir results/
```

---

## ğŸ“ æ•°æ®é›†

### æ”¯æŒçš„æ”»å‡»æ•°æ®é›†

| æ•°æ®é›† | æè¿° | æ”»å‡»ç±»å‹ | æ•°æ®é‡ |
|--------|------|----------|--------|
| **HarmBench** | æ ‡å‡†æ¶æ„æŸ¥è¯¢åŸºå‡† | æ–‡æœ¬æ”»å‡» | 200ä¸ªæŸ¥è¯¢ |
| **FigStep** | æ’ç‰ˆå›¾åƒæ”»å‡» | è§†è§‰æ”»å‡» | è‡ªç”Ÿæˆ |
| **MM-SafetyBench** | å¤šæ¨¡æ€å®‰å…¨åŸºå‡† | è·¨æ¨¡æ€æ”»å‡» | å¤šç±»å‹ |
| **Hades** | å¤åˆæ”»å‡»ç­–ç•¥ | å¤šå±‚æ”»å‡» | æ··åˆæ•°æ® |
| **ImgJP** | å¯¹æŠ—æ€§å›¾åƒæ‰°åŠ¨ | å¯¹æŠ—æ”»å‡» | ä¼˜åŒ–ç”Ÿæˆ |

### æ•°æ®å‡†å¤‡

```bash
# ä¸‹è½½å¹¶å‡†å¤‡æ•°æ®é›†
python data/prepare_datasets.py --download-all
```

---

## ğŸ“ è¯„ä¼°æŒ‡æ ‡

### ä¸»è¦æŒ‡æ ‡

- **ASR (Attack Success Rate)**: æ”»å‡»æˆåŠŸç‡ï¼Œè¶Šä½è¶Šå¥½
- **Safety Score**: å®‰å…¨æ€§è¯„åˆ† (0-1)
- **Utility Score**: æ•ˆç”¨æ€§è¯„åˆ† (0-1)
- **Response Time**: å¹³å‡å“åº”æ—¶é—´

### è®¡ç®—å…¬å¼

```python
ASR = n_successful_attacks / n_total_attacks
Safety_Score = 1 - ASR
Utility_Score = quality_score * helpfulness_score
```

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
MLLM-Jailbreak-Defense/
â”œâ”€â”€ ğŸ“ src/                    # æºä»£ç 
â”‚   â”œâ”€â”€ ğŸ models/             # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ ğŸ›¡ï¸ defense/            # é˜²å¾¡æœºåˆ¶
â”‚   â”œâ”€â”€ âš”ï¸ attacks/            # æ”»å‡»æ–¹æ³•
â”‚   â””â”€â”€ ğŸ”§ utils/              # å·¥å…·å‡½æ•°
â”œâ”€â”€ ğŸ“ data/                   # æ•°æ®é›†
â”‚   â”œâ”€â”€ ğŸ“Š harmbench/          # HarmBenchæ•°æ®
â”‚   â”œâ”€â”€ ğŸ–¼ï¸ attack_images/      # æ”»å‡»å›¾åƒ
â”‚   â””â”€â”€ ğŸ“‹ prompts/            # æç¤ºè¯æ¨¡æ¿
â”œâ”€â”€ ğŸ“ experiments/            # å®éªŒè„šæœ¬
â”‚   â”œâ”€â”€ ğŸ§ª run_defense.py      # é˜²å¾¡å®éªŒ
â”‚   â”œâ”€â”€ ğŸ“ˆ evaluate.py         # è¯„ä¼°è„šæœ¬
â”‚   â””â”€â”€ ğŸ“Š analyze_results.py  # ç»“æœåˆ†æ
â”œâ”€â”€ ğŸ“ results/                # å®éªŒç»“æœ
â”œâ”€â”€ ğŸ“ configs/                # é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“ docs/                   # æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ requirements.txt        # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ ğŸ”§ setup.py               # å®‰è£…è„šæœ¬
â””â”€â”€ ğŸ“– README.md              # é¡¹ç›®è¯´æ˜
```

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼è¯·æŸ¥çœ‹ [CONTRIBUTING.md](CONTRIBUTING.md) äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚

### ğŸŒŸ å¦‚ä½•è´¡çŒ®

1. **Fork** æœ¬é¡¹ç›®
2. **åˆ›å»º** æ–°çš„åŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. **æäº¤** ä½ çš„ä¿®æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. **æ¨é€** åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. **å¼€å¯** Pull Request

### ğŸ› æŠ¥å‘Šé—®é¢˜

å¦‚æœä½ å‘ç°äº†bugæˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Œè¯·[åˆ›å»ºissue](https://github.com/yourusername/MLLM-Jailbreak-Defense/issues)ã€‚

---

## ğŸ“š å¼•ç”¨

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œè¯·è€ƒè™‘å¼•ç”¨ï¼š

```bibtex
@article{zhang2024mllm_defense,
  title={åŸºäºæ„å›¾åˆ†æçš„å¤šæ¨¡æ€å¤§æ¨¡å‹è¶Šç‹±æ”»å‡»é˜²å¾¡æŠ€æœ¯ç ”ç©¶},
  author={å¼ ä¸€ and ææ¾æ³½},
  journal={ä¸œå—å¤§å­¦å¤§å­¦ç”Ÿåˆ›æ–°è®­ç»ƒé¡¹ç›®},
  year={2024},
  institution={ä¸œå—å¤§å­¦ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢}
}
```

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE)ã€‚

---

## ğŸ“ è”ç³»æˆ‘ä»¬

### ğŸ‘¥ é¡¹ç›®å›¢é˜Ÿ

- **é¡¹ç›®è´Ÿè´£äºº**: å¼ ä¸€ ([zhangyi1@seu.edu.com](mailto:zhangyi1@seu.edu.com))
- **æŒ‡å¯¼è€å¸ˆ**: ææ¾æ³½
- **æ‰€å±æœºæ„**: ä¸œå—å¤§å­¦ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢

### ğŸ”— ç›¸å…³é“¾æ¥

- ğŸ  [é¡¹ç›®ä¸»é¡µ](https://github.com/yourusername/MLLM-Jailbreak-Defense)
- ğŸ“– [æ–‡æ¡£](https://mllm-defense.readthedocs.io/)
- ğŸ› [é—®é¢˜è¿½è¸ª](https://github.com/yourusername/MLLM-Jailbreak-Defense/issues)
- ğŸ’¬ [è®¨è®ºåŒº](https://github.com/yourusername/MLLM-Jailbreak-Defense/discussions)

---

<div align="center">

### ğŸŒŸ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªStarï¼

[![Star History Chart](https://api.star-history.com/svg?repos=yourusername/MLLM-Jailbreak-Defense&type=Date)](https://star-history.com/#yourusername/MLLM-Jailbreak-Defense&Date)

</div>

---

<div align="center">
  <sub>Built with â¤ï¸ by the Southeast University Cybersecurity Team</sub>
</div>
